{% extends "The6ixDjango/base_enh.html" %}
{% load crispy_forms_tags %}
{% load static %}
{% block content %}
        <div id="welcome_to_the_six">
            <div id="jumbotron" class="p-5 mb-4 bg-light round-3" style="background: linear-gradient(51deg, rgb(255,255,255) 0%, rgb(255,255,255) 2%, rgb(236,223,137) 99%, white), rgb(218,221,160);">
                <div class="container-fluid py-0" style="*padding-top: 2px; text-align: left">
                        <h2 style="box-shadow: 0px 0px;">{{ dyn_title }}</h2>
                    <hr/>
                    <div class="content-section">
                        <div class="form-check mt-2 mb-2" style="background: linear-gradient(231deg, rgb(255,255,255) 0%, rgb(255,255,255) 2%, rgb(236,223,137) 90%)">
                            <br>
                            <form action="." method="POST">
                            {% csrf_token %}
                            <div class="span-2 mt-2 mb-2" style="width: 25%">
                                <input class="btn btn-light action-button" type="Submit" name="Return to Member Report" value="Return to Member Report" style="background: #e7bb3f;"></input>
                            </div>
                            <div class="span-2 mt-2 mb-2" style="width: 25%">
                                <input class="btn btn-light action-button" type="Submit" name="Perform Card Analysis" value="Perform Card Analysis" style="background: rgb(94,181,246);"></input>
                            </div>
                            <div class="span-2 mt-2 mb-2" style="width: 25%">
                                <input class="btn btn-light action-button" type="Submit" name="Return to Menu" value="Return to Menu" style="background: rgb(255, 93, 5);"></input>
                            </div>

                            </form>
                             <div class="mb-2">
                                <p style="margin-top: 5px; margin-bottom: 5px">* Note that Card Analysis may take up to 3 minutes to complete.</p>
                                 <br>
                            </div>
                        </div>
                                        </div>
                </div>
            </div>
                        <div class="table-responsive">
                            <h4 style="box-shadow: 0px 0px;">Probability Analysis for: <a href="https://royaleapi.com/player/{{ player_tag }}/battles">{{ player_name }}</a> vs. <a href="https://royaleapi.com/player/{{ away_tag }}/battles">{{ away_name }}</a></h4>
                            <br>

                            <table class="table table-hover table-striped">
                              <thead>
                                <tr>
                                  <th scope="col"></th>
                                  <th scope="col" style="text-align: right">Impact</th>
                                  <th scope="col" style="text-align: right">Cumulative</th>
                                </tr>
                              </thead>
                            <tbody>
                                <tr>
                                  <th scope="row">{{ row_int }}</th>
                                  <td style="text-align: right">{{ intercept }}</td>
                                  <td style="text-align: right">{{ cintercept }}</td>
                                </tr>
                                <tr>
                                  <th scope="row" style="font-weight: normal;">{{ row_lsg }}</th>
                                  <td style="text-align: right">{{ last_season_gap }}</td>
                                  <td style="text-align: right">{{ clsg }}</td>
                                </tr>
                                <tr>
                                  <th scope="row" style="font-weight: normal;">{{ row_bsd }}</th>
                                  <td style="text-align: right">{{ best_season_difference }}</td>
                                  <td style="text-align: right">{{ cbsd }}</td>
                                </tr>
                                <tr>
                                  <th scope="row" style="font-weight: normal;">{{ row_ted }}</th>
                                  <td style="text-align: right">{{ tower_experience_difference }}</td>
                                  <td style="text-align: right">{{ cted }}</td>
                                </tr>
                                <tr>
                                  <th scope="row" style="font-weight: normal;">{{ row_ced }}</th>
                                  <td style="text-align: right">{{ card_experience_difference }}</td>
                                  <td style="text-align: right">{{ cced }}</td>
                                </tr>
                                <tr>
                                  <th scope="row" style="font-weight: normal;">{{ row_ded }}</th>
                                  <td style="text-align: right">{{ deck_experience_difference }}</td>
                                  <td style="text-align: right">{{ cded }}</td>
                                </tr>
                                <tr>
                                  <th scope="row">{{ row_fin }}</th>
                                  <td style="text-align: right"></td>
                                  <td style="text-align: right">{{ cfin }}</td>
                                </tr>
                                <tr>
                                  <th scope="row"></th>
                                  <td style="text-align: right"></td>
                                  <td style="text-align: right"></td>
                                </tr>
                                <tr>
                                  <th scope="row">{{ row_sup }}</th>
                                  <td style="text-align: right"></td>
                                  <td style="text-align: right">{{ csup }}</td>
                                </tr>

                            </tbody>
                            </table>
                        </div>
        {% block javascript %}
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script type="text/javascript">
        $(document).ready(function call_api () {
            $.ajax({
            url: '/clashstats/win_deep/get_ajax/',
            type: 'get',
            headers: { "X-CSRFToken": csrftoken },

            success: function polling (ret_val) {
                if (ret_val.do_what == 'nothing') {
                    console.log('Do nothing')
                } else if (ret_val.do_what == 'wait') {
                    $("#message_loading_space").show();
                    $("#message_loading_space").html(ret_val.msg);
                    setTimeout(call_api, 3000); // wait 3 seconds than call ajax request again
                } else if (ret_val.do_what == 'complete') {
                    console.log('complete')
                    $("#message_loading_space").hide();
                    $("#singleS").html(ret_val.singleS);
                    $("#doubleS").html(ret_val.doubleS);
                }
                }
            })

            });

            function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
            }
            return cookieValue;
            }
            var csrftoken = getCookie('csrftoken');
        </script>
        {% endblock javascript %}
                <div id="message_loading_space" style="text-align: left">
                </div>
                <table id="singleS">

                </table>
                <hr/>
                <table id="doubleS">

                </table>


        </div>

{% endblock content %}